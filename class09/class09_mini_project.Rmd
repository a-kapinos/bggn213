---
title: "class09"
author: "Andrew Kapinos"
date: "10/27/2021"
output: pdf_document
---

## Getting organized, Preparing the Data

```{r}
fna.data <- "WisconsinCancer.csv"
wisc.df <- read.csv(fna.data, row.names=1)
head(wisc.df)
```

```{r}
wisc.data <- wisc.df[,-1]
diagnosis <- as.factor(wisc.df[,1])
```

The functions dim(), nrow(), table(), length() and grep() may be useful for answering the first 3 questions.

>Q1. How many observations are in this dataset?

```{r}
nrow(wisc.data)
```

**There are 569 observations in the dataset.**

>Q2. How many of the observations have a malignant diagnosis?

```{r}
table(diagnosis)
```
**212 of the observations have a malignant diagnosis.**

>Q3. How many variables/features in the data are suffixed with _mean?

```{r}
length(grep("_mean",colnames(wisc.data)))
```

**There are 10 variables/features in the data suffixed with "_mean". **

## Performing PCA

Check column means and standard deviations


```{r}
colMeans(wisc.data)
apply(wisc.data,2,sd)
wisc.pr <- prcomp(wisc.data,scale=TRUE)
summary(wisc.pr)
```

>Q4. From your results, what proportion of the original variance is captured by the first principal components (PC1)?

```{r}
summary(wisc.pr)$importance[2,]
```

**44.27% of the original variance is captured by the first principal component (PC1).**

>Q5. How many principal components (PCs) are required to describe at least 70% of the original variance in the data?

```{r}
summary(wisc.pr)$importance[3,]
```

**Three PCs are required to describe at least 70% of the original variance in the data (PC1, PC2, and PC3 together describe 72.636% of the original variance).**

Q6. How many principal components (PCs) are required to describe at least 90% of the original variance in the data?

**From above, seven PCs are required to describe at least 90% of the original variance in the data (PC1 through PC7 describe 91.01% of the original variance).**

## Interpreting PCS results

```{r}
biplot(wisc.pr)
```

>Q7. What stands out to you about this plot? Is it easy or difficult to understand? Why?

**The plot is not informative because it is extremely crowded. This is not useful for interpreting the PCA results.**

Scatter plot observations by components 1 and 2
```{r}
plot(wisc.pr$x[,1:2],col=diagnosis,xlab="PC1",ylab="PC2")
```

>Q8. Generate a similar plot for principal components 1 and 3. What do you notice about these plots?

Scatter plot observations by components 1 and 3
```{r}
plot(wisc.pr$x[,1],wisc.pr$x[,3],col=diagnosis,xlab="PC1",ylab="PC2")
```

**The graphs look somewhat similar; since PC1 accounts for most of the variance in both comparisons, the majority of the distribution of the points is along the x axis. Both plots display that PC1 captures the separation between malignant and benign samples (red v. black). However, PC2 does describe a bit more variance than PC3, so the first plot (PC2 v. PC1) has a bit more spread between the points than the second plot (PC3 v. PC1).**

## Using ggplot2 for analysis of PCA

```{r}
# Create a data.frame for ggplot
df <- as.data.frame(wisc.pr$x)
df$diagnosis <- diagnosis

# Load the ggplot2 package
library(ggplot2)

# Make a scatter plot colored by diagnosis
ggplot(df) + 
  aes(PC1, PC2, col=diagnosis) + 
  geom_point()
```

## Variance explained (using scree plots)

Calculate variance of each component
```{r}
pr.var <- wisc.pr$sdev^2
head(pr.var)
```

```{r}
pve <- pr.var/sum(pr.var)
plot(pve, xlab = "Principal Component", 
     ylab = "Proportion of Variance Explained", 
     ylim = c(0, 1),type = "o")
```

Alternative scree plot of the same data, note data driven y-axis
```{r}
barplot(pve,ylab="Precent of Variance Explained",
     names.arg=paste0("PC",1:length(pve)),las=2,axes=FALSE)
axis(2,at=pve,labels=round(pve,2)*100)
```

```{r}
library(factoextra)
fviz_eig(wisc.pr, addlabels = TRUE)
```

## Communicating PCA results

>Q9. For the first principal component, what is the component of the loading vector (i.e. wisc.pr$rotation[,1]) for the feature concave.points_mean?

```{r}
wisc.pr$rotation[,1]
```
**The component of the loading vector for concave.points_mean is -0.26085376.**

>Q10. What is the minimum number of principal components required to explain 80% of the variance of the data?

```{r}
summary(wisc.pr)$importance[3,]
```

**From above, five PCs are required to describe at least 80% of the original variance in the data (PC1 through PC5 describe 84.734% of the original variance).**

## Hierarchical clustering

Scale the wisc.data data using the "scale()" function
```{r}
data.scaled <- scale(wisc.data)
```

```{r}
data.dist <- dist(data.scaled)
```

```{r}
wisc.hclust <- hclust(data.dist, method="complete")
```

>Q11. Using the plot() and abline() functions, what is the height at which the clustering model has 4 clusters?

```{r}
plot(wisc.hclust)
abline(h=20, col="red", lty=2)
abline(h=19, col="blue", lty=2)
```

**Either h=19 (blue) or h=20 (red) are heights at which the clustering model has 4 clusters.**

# Selecting number of clusters

```{r}
wisc.hclust.clusters <- cutree(wisc.hclust,h=19)
table(wisc.hclust.clusters,diagnosis)
```

>Q12. Can you find a better cluster vs diagnoses match by cutting into a different number of clusters between 2 and 10?

```{r}
wisc.hclust.clusters.2 <- cutree(wisc.hclust,h=25)
table(wisc.hclust.clusters.2,diagnosis)
wisc.hclust.clusters.3 <- cutree(wisc.hclust,h=22)
table(wisc.hclust.clusters.3,diagnosis)
wisc.hclust.clusters.5 <- cutree(wisc.hclust,h=18)
table(wisc.hclust.clusters.5,diagnosis)
wisc.hclust.clusters.7 <- cutree(wisc.hclust,h=16)
table(wisc.hclust.clusters.7,diagnosis)
wisc.hclust.clusters.9 <- cutree(wisc.hclust,h=13)
table(wisc.hclust.clusters.9,diagnosis)
```

**Yes; at h=18, using 5 clusters. When using 4 clusters, 1/4 clusters contain only B *or* M, while when using 5 clusters, 3/5 clusters contain only B *or* M.**

**The number of observations in the mixed B *and* M clusters remains approximately the same when using 5 vs. 4 clusters. Adding any more clusters actually introduces additional mixed clusters, and does not improve the separation between B and M observations.**

>Q13. Which method gives your favorite results for the same data.dist dataset? Explain your reasoning.

```{r}
plot(hclust(data.dist,method="single"))
plot(hclust(data.dist,method="complete"))
plot(hclust(data.dist,method="average"))
plot(hclust(data.dist,method="ward.D2"))
```

**I personally prefer the "ward.D2" method, because the terminal nodes of the dendrogram are aligned at the bottom of the graphic (this feels familiar to my prior experience viewing and interpreting dendrograms). The root/early branching of the tree is spread out as well, which would make selecting the cutree() height easier visually speaking.**

## K-means clustering

```{r}
wisc.km <- kmeans(wisc.data, centers=2, nstart=20)
table(wisc.km$cluster,diagnosis)
wisc.hclust.clusters.5 <- cutree(wisc.hclust,h=18)
table(wisc.hclust.clusters.5,diagnosis)
```

>Q14. How well does k-means separate the two diagnoses? How does it compare to your hclust results?

**K-means separates the clusters relatively well; cluster 2 contains mostly M (129/130 obs.), while cluster 1 is slightly less well separated. Compared to hclust, using 5 clusters, the reverse effect is seen. Hclust seems to have better separated out B observations (the predominantly "B" cluster contains half as many "M"s when compared to the K-means method). Overall, niether approach is perfect, but both provide a nice, quick approximation.**


## Combining methods, clustering on PCA results

```{r}
wisc.pr.dist.17 <- dist(wisc.pr$x[,1:7])
wisc.pr.hclust <- hclust(wisc.pr.dist.17,method="ward.D2")
plot(wisc.pr.hclust)
```

```{r}
grps <- cutree(wisc.pr.hclust,k=2)
table(grps)
```

```{r}
table(grps,diagnosis)
```

```{r}
plot(wisc.pr$x[,1:2],col=grps)
```

```{r}
plot(wisc.pr$x[,1:2],col=diagnosis)
```
```{r}
g <- as.factor(grps)
levels(g)
g <- relevel(g,2)
levels(g)
plot(wisc.pr$x[,1:2], col=g)
```

```{r}
#library(rgl)
#plot3d(wisc.pr$x[,1:3], xlab="PC 1", ylab="PC 2", zlab="PC 3", cex=1.5, size=1, type="s", col=grps)
#rglwidget(width = 400, height = 400)
```

